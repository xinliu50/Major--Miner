(this.webpackJsonpmajor_miner=this.webpackJsonpmajor_miner||[]).push([[0],{267:function(e,t,a){e.exports=a(496)},272:function(e,t,a){},496:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(30),c=a.n(o),s=a(12),i=a(13),l=a(15),u=a(14),m=a(16),d=a(208),h=(a(272),a(499)),p=a(500),g=a(501),f=a(24),y=a.n(f),b=(a(335),a(337),y.a.initializeApp({apiKey:"AIzaSyDD9v_OHP17-bC2ZyuHVo1zsH2LkgnIAVo",authDomain:"majorminer-dd13a.firebaseapp.com",databaseURL:"https://majorminer-dd13a.firebaseio.com",projectId:"majorminer-dd13a",storageBucket:"majorminer-dd13a.appspot.com",messagingSenderId:"526186255270"})),E=a(42),v=a(1),w=a(498),k=a(9),x=a.n(k),O=a(23),j=a(502),S=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleClickOpen=function(){a._isMounted&&a.setState({open:!0})},a.handleClose=function(){a._isMounted&&a.setState({open:!1})},a.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("submitButton").click()},a.handleSubmit=function(){var e=Object(O.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,b.auth().signInWithEmailAndPassword(document.getElementById("email").value,document.getElementById("password").value);case 4:n=e.sent,console.log(n),n&&(a.handleClose(),a.props.history.push("/main")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),alert(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),a._isMounted=!1,a.state={open:!1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){return r.a.createElement(v.q,{item:!0},r.a.createElement(v.b,{color:"default",variant:"outlined",onClick:this.handleClickOpen},"Login"),r.a.createElement(v.j,{open:this.state.open,onClose:this.handleClose,maxWidth:"xs",fullWidth:!0},r.a.createElement(v.m,null,"Login"),r.a.createElement(v.l,null,r.a.createElement(v.q,{container:!0,direction:"column",spacing:16},r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Email"),r.a.createElement(v.u,{id:"email",onKeyPress:this.handleKeyPress}))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Password"),r.a.createElement(v.u,{id:"password",type:"password",onKeyPress:this.handleKeyPress}))))),r.a.createElement(v.k,null,r.a.createElement(v.b,{id:"submitButton",onClick:this.handleSubmit},"Submit"))))}}]),t}(n.Component),C=Object(j.a)(S),I=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"privacy-container"},r.a.createElement("h1",{className:"page-title"},"Privacy and Participation"),r.a.createElement("p",null,"You are being asked to participate in this research study because you are an adult at least 18 years of age. The purpose of this research study is to collect descriptions of sounds from people, so that we can train computer models to automatically describe new sounds. If you agree to participate, we will ask you to listen to sounds and provide free-form textual descriptions of them. Listening to and labeling each sound will take less than a minute, and you can do as many or as few as you would like, whenever you would like. Research-related risks to you are minimal, but include fatigue and exposure to volume variations between sounds. We will only record your descriptions, we will not record any personally identifiable information from you and will only identify you within our system by a username of your choosing. The descriptions that we collect will be stored on our servers at Brooklyn College and made available to other researchers for the same purpose. Your participation in this research is voluntary. If you have any questions, you can contact Michael Mandel at"," ",r.a.createElement("a",{target:"_blank",href:"mailto:mim@sci.brooklyn.cuny.edu",rel:"noopener noreferrer"},"mim@sci.brooklyn.cuny.edu"),"\xa0or 718.951.5000 x2053. If you have any questions about your rights as a research participant or if you would like to talk to someone other than the researchers, you can contact CUNY Research Compliance Administrator at 646-664-8918 or"," ",r.a.createElement("a",{target:"_blank",href:"mailto:HRPP@cuny.edu",rel:"noopener noreferrer"},"HRPP@cuny.edu"),"."))}}]),t}(n.Component),T=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleClickOpenForm=function(){a.setState({openForm:!0})},a.handleCloseForm=function(){a.setState({openForm:!1,agreePolicy:!1})},a.handleAgreePolicy=function(e){a.setState({agreePolicy:e.target.checked}),e.target.checked&&a.setState({policyError:!1})},a.handleClickOpenPolicy=function(){a.setState({openPolicy:!0})},a.handleClosePolicy=function(){a.setState({openPolicy:!1})},a.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("submitButton").click()},a.validateForm=function(){var e=document.getElementById("username").value,t=document.getElementById("email").value,n=document.getElementById("password").value,r=document.getElementById("password2").value;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?a.setState({emailError:!1}):a.setState({emailError:!0}),n.length<6?a.setState({passwordError:!0}):a.setState({passwordError:!1}),n!==r?a.setState({password2Error:!0}):a.setState({password2Error:!1}),""===e?a.setState({usernameError:!0}):a.setState({usernameError:!1}),a.state.agreePolicy||a.setState({policyError:!0}),{email:t,password:n,username:e}},a.handleSubmit=function(){var e=Object(O.a)(x.a.mark((function e(t){var n,r,o,c,s,i,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.history,t.preventDefault(),e.next=4,a.validateForm();case 4:if(r=e.sent,o=r.email,c=r.password,s=r.username,i=b.firestore(),a.state.policyError||a.state.emailError||a.state.passwordError||a.state.password2Error||a.state.usernameError){e.next=21;break}return e.prev=10,e.next=13,b.auth().createUserWithEmailAndPassword(o,c);case 13:l=e.sent,console.log(l),l&&(i.collection("users").doc(b.auth().currentUser.uid).set({username:s,score:0}),a.handleCloseForm(),n.push("/main")),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),alert(e.t0);case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}(),a.state={openForm:!1,agreePolicy:!1,openPolicy:!1,policyError:!1,emailError:!1,passwordError:!1,password2Error:!1,usernameError:!1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(v.q,{item:!0},r.a.createElement(v.b,{color:"default",variant:"outlined",onClick:this.handleClickOpenForm},"Register"),r.a.createElement(v.j,{open:this.state.openForm,onClose:this.handleCloseForm,maxWidth:"xs",fullWidth:!0},r.a.createElement(v.m,null,"Register"),r.a.createElement(v.l,null,r.a.createElement(v.q,{container:!0,direction:"column",justify:"space-evenly",alignItems:"stretch"},r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Username"),r.a.createElement(v.u,{id:"username",type:"text",onKeyPress:this.handleKeyPress})),this.state.usernameError?r.a.createElement(v.p,{error:!0},"Must Enter Your Username."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Email"),r.a.createElement(v.u,{id:"email",type:"email",onKeyPress:this.handleKeyPress})),this.state.emailError?r.a.createElement(v.p,{error:!0},"Invalid email."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Password"),r.a.createElement(v.u,{id:"password",type:"password",onKeyPress:this.handleKeyPress})),this.state.passwordError?r.a.createElement(v.p,{error:!0},"Password should be more than 6 characters."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Reenter password"),r.a.createElement(v.u,{id:"password2",type:"password",onKeyPress:this.handleKeyPress})),this.state.password2Error?r.a.createElement(v.p,{error:!0},"Passwords didn't match."):""),r.a.createElement(v.q,{item:!0},r.a.createElement(v.o,{control:r.a.createElement(v.g,{checked:this.state.agreePolicy,onChange:this.handleAgreePolicy}),label:r.a.createElement("p",null,"I accept the\xa0",r.a.createElement(v.x,{component:"button",onClick:this.handleClickOpenPolicy,style:{fontSize:"1em"}},"Privacy Policy"))}),this.state.policyError?r.a.createElement(v.p,{error:!0},"You have to accept the privacy policy."):"",r.a.createElement(v.j,{open:this.state.openPolicy,onClose:this.handleClosePolicy,maxWidth:!1},r.a.createElement(v.l,{className:"privacy-in-dialog"},r.a.createElement(I,null)))))),r.a.createElement(v.k,null,r.a.createElement(v.b,{id:"submitButton",onClick:this.handleSubmit},"Submit"))))}}]),t}(n.Component),P=Object(j.a)(T),A=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(v.q,{container:!0,className:"home-container",direction:"column",alignItems:"center"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",{style:{fontSize:"2.5em"}},"Major Miner"),r.a.createElement("p",{style:{fontSize:"1.25em"}},"A Sound Labeling Game")),r.a.createElement(v.q,{item:!0,lg:6,md:8,sm:10},r.a.createElement("p",null,"The goal of the game, besides just listening to interesting soundscapes, is to label them with ",r.a.createElement("b",null,"original"),", yet ",r.a.createElement("b",null,"relevant")," words and phrases that other players ",r.a.createElement("b",null,"agree with"),". We're going to use your descriptions to teach our computers to recognize these same sounds in over 100,000 hours of recordings so that we can better understand the behavior of animals and how it is affected by human activity.")),this.props.authenticated?r.a.createElement(v.q,{item:!0,sm:8,md:8,lg:8,container:!0,justify:"center",spacing:16},r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main"},"Summary")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main/clip"},"Play game!"))):r.a.createElement(v.q,{item:!0,sm:8,md:8,lg:8,container:!0,justify:"center",spacing:16},r.a.createElement(C,null),r.a.createElement(P,null)))}}]),t}(n.Component),q=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(v.q,{container:!0,className:"footer",justify:"center",spacing:8},r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/"},"Home")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/info/faq"},"FAQ")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/info/contact"},"Contact us")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/info/privacy"},"Privacy policy")))}}]),t}(n.Component),D=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(v.q,{container:!0,direction:"column"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",{className:"page-title",style:{paddingTop:"1em"}},"Frequently asked questions")),r.a.createElement(v.q,{item:!0,container:!0,className:"faq-container",direction:"column",spacing:16,alignItems:"stretch"},r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"How should I describe clips?"),r.a.createElement("p",null,"There are many ways you could describe a clip, we want you to make up your own, but if you're stuck, here are some examples. You could use the names of the things you hear (as specifically or generally as you like), general descriptions of the scene, the time of day or year you think it is, even how it makes you feel. Here are some examples, by no means exhaustive, of each of those categories:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Animals \u2013 bird, songbird, sparrow, white-crowned sparrow, gambel's white crowned sparrow"),r.a.createElement("li",null,"Human-generated sounds \u2013 airplane, helicopter, drilling, engine, rumbling"),r.a.createElement("li",null,"Weather \u2013 wind, rain, thunder, gale, drizzle, dripping, stream, river"),r.a.createElement("li",null,"Scenes \u2013 quiet night, dawn chorus"),r.a.createElement("li",null,"Time \u2013 summer, winter, june, august afternoon, night, dawn"),r.a.createElement("li",null,"Feelings \u2013 calm, busy, soothing, loud, cacophonous"))))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"Can I input more than one tag at a time?"),r.a.createElement("p",null,"Yes, separate your tags with commas.")))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"What's a good strategy to use?"),r.a.createElement("p",null,"If you want to earn some points quickly, you can try to guess the obvious labels for a clip. Someone else has probably already used them, so you might get 1 point or you might get 0 points, depending on how many people have used them already. If you're feeling more patient, you can tag a clip with a slightly less obvious, more creative, or more subjective label, so you'll have a better chance of being the first person to use that tag. You won't get any points initially, but when someone else comes along and uses it too, you'll get 2 points. You'd be surprised how frequently other people are thinking the same thing as you. Just remember that every time one user scores a single point, another user has just scored two.")))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"Does it matter how I capitalize, punctuate, or spell words?"),r.a.createElement("p",null,"Not much. Our matching algorithm is clever enough to handle these and give you credit for matching other players' tags that differ in capitalization, punctuation, and spelling")))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"I found a clip that won't play"),r.a.createElement("p",null,'If you press the play button and it jumps right back to "play" mode without playing anything, you\'ve probably found a broken clip. If you could tag it "won\'t play", we\'ll remove it from the game as quickly as we can.')))),r.a.createElement(v.q,{item:!0},r.a.createElement(v.d,null,r.a.createElement(v.f,null,r.a.createElement("h3",null,"I tried using my browser's back button to go back to my last clip, but it seems to be acting funny"),r.a.createElement("p",null,"That's intentional. Once you've gone to the summary page, you can go back and listen to your last clip (which you can do that from the summary page anyway), but you can't tag it any more. Any tags you try to submit will be ignored. Only go to the summary page once you're finished tagging your current clip. This is to prevent people from looking at the artist name or other metadata when they're tagging a clip."))))))}}]),t}(n.Component),N=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"contact-container"},r.a.createElement("h1",{className:"page-title"},"Contact us"),r.a.createElement("p",null,"Please contact us with any questions, comments, congratulations, or concerns."),r.a.createElement("p",null,"The easiest way is to leave a comment on our blog,"),r.a.createElement("a",{href:"http://blog.majorminer.org"},"blog.majorminer.org"),r.a.createElement("p",null,"but email is also welcome:"),r.a.createElement("a",{target:"_blank",href:"mailto:info@majorminer.org",rel:"noopener noreferrer"},"info@majorminer.org"))}}]),t}(n.Component),R=a(201),M=a.n(R),U=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleToggle=function(){a.setState((function(e){return{open:!e.open}}))},a.handleClose=function(e){a.setState({open:!1})},a.state={open:!1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.state.open;return r.a.createElement("div",null,r.a.createElement(v.t,{buttonRef:function(t){e.anchorEl=t},"aria-owns":t?"account-menu":void 0,"aria-haspopup":"true",onClick:this.handleToggle,color:"inherit"},r.a.createElement(M.a,null)),r.a.createElement(v.B,{open:t,anchorEl:this.anchorEl,placement:"bottom-end",transition:!0,disablePortal:!0},(function(t){var a=t.TransitionProps;return r.a.createElement(v.r,a,r.a.createElement(v.A,null,r.a.createElement(v.i,{onClickAway:e.handleClose},r.a.createElement(v.z,null,r.a.createElement(v.y,{onClick:e.handleClose},r.a.createElement(w.a,{to:"/main"},"Summary")),r.a.createElement(v.y,{onClick:e.handleClose},"Change password"),r.a.createElement(v.y,{onClick:function(){e.props.logout(),e.handleClose()}},"Logout")))))})))}}]),t}(n.Component),F=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logout=function(){a.userDocListener&&a.userDocListener(),b.auth().signOut().then((function(){a.props.toggleAuth(!1)})).catch((function(e){console.log(e)})),a.props.history.push("/"),a.setState({score:0})},a.state={open:!1,score:null},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.db=b.firestore(),this.user=b.auth().currentUser,this.user&&this.db.collection("users").doc(this.user.uid).get().then((function(t){e.setState({score:t.data().score})}))}},{key:"componentWillUnmount",value:function(){this.userDocListener&&this.userDocListener()}},{key:"render",value:function(){return r.a.createElement(v.a,{position:"sticky"},r.a.createElement(v.J,null,r.a.createElement("div",{className:"nav-container"},r.a.createElement(v.c,{component:w.a,to:"/",className:"nav-item"},r.a.createElement("b",{style:{fontSize:"1.5em"}},"Major Miner")),this.props.authenticated?r.a.createElement(v.c,{component:w.a,to:"/main/clip",className:"nav-item"},"Game"):"",this.props.authenticated?r.a.createElement(v.c,{component:w.a,to:"/info/leaders",className:"nav-item"},"Leaders"):"",r.a.createElement(v.c,{component:w.a,to:"/search",className:"nav-item"},"Search"),this.props.authenticated?r.a.createElement("div",{className:"account-button"},r.a.createElement("h4",{style:{margin:"0 0.5em",padding:"0 0.5em"}},"Score: ",this.state.score),r.a.createElement(U,{logout:this.logout})):r.a.createElement("div",{className:"account-button"},r.a.createElement(C,null)))))}}]),t}(n.Component),H=Object(j.a)(F),z=a(124),W=a(204),B=a.n(W),L=a(203),_=a.n(L),K=a(202),V=a.n(K),Y=a(205),G=a.n(Y),J=a(88),Z=a(91),$=a.n(Z),Q=a(90),X=a.n(Q),ee=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).canvas=r.a.createRef(),a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(){this.draw()}},{key:"draw",value:function(){var e=this.props.audioData,t=this.canvas.current,a=t.height,n=t.width,r=t.getContext("2d"),o=0,c=1*n/e.length;r.lineWidth=1,r.strokeStyle="#000000",r.clearRect(0,0,n,a),r.beginPath(),r.moveTo(0,a/2);var s=!0,i=!1,l=void 0;try{for(var u,m=e[Symbol.iterator]();!(s=(u=m.next()).done);s=!0){var d=u.value/255*a;r.lineTo(o,d),o+=c}}catch(h){i=!0,l=h}finally{try{s||null==m.return||m.return()}finally{if(i)throw l}}r.lineTo(o,a/2),r.stroke()}},{key:"render",value:function(){return r.a.createElement("canvas",{width:"300",height:"300",ref:this.canvas,className:"audio-canvas"})}}]),t}(n.Component),te=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).setupAudioContext=function(){a.audioContext=new(window.AudioContext||window.webkitAudioContext),a.gainNode=a.audioContext.createGain(),a.gainNode.gain.value=15,a.gainNode.connect(a.audioContext.destination),a.audioSource=a.audioContext.createMediaElementSource(a.audio),a.audioSource.connect(a.gainNode),a.analyser=a.audioContext.createAnalyser(),a.gainNode.connect(a.analyser),a.dataArray=new Uint8Array(a.analyser.frequencyBinCount),a.rafId=requestAnimationFrame(a.tick),a.audio.onended=function(){a._isMounted&&a.setState({play:!1})}},a.toggleAudio=function(){if(0===a.firstPlay)try{a.setupAudioContext(),console.log("props!",a.props.clipId);var e=Date.now();a.db.collection("Randomize").doc(a.props.clipId).set({count:y.a.firestore.FieldValue.increment(1),updated:y.a.firestore.FieldValue.serverTimestamp(),millis:e,userId:y.a.firestore.FieldValue.arrayUnion(a.currentId)},{merge:!0})}catch(t){console.log(t)}a.state.play?a.audio.pause():a.playAuto(a.audio),a._isMounted&&a.setState({play:!a.state.play}),a.firstPlay++},a._isMounted=!1,a.state={audioData:new Uint8Array(0),play:!1,url:""},a.tick=a.tick.bind(Object(J.a)(a)),a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.user=b.auth().currentUser,this.db=b.firestore(),this.currentId=b.auth().currentUser.uid,this.firstPlay=0,this.audio=new Audio(this.props.url),this.audio.crossOrigin="anonymous",window.screen.height>420&&window.screen.width>380&&this.toggleAudio()}},{key:"tick",value:function(){this.analyser.getByteTimeDomainData(this.dataArray),this._isMounted&&this.setState({audioData:this.dataArray}),this.rafId=requestAnimationFrame(this.tick)}},{key:"playAuto",value:function(e){this.audioContext.resume().then((function(){e.play()}))}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.rafId),this.analyser.disconnect(),this.gainNode.disconnect(),this.audioSource.disconnect(),this._isMounted=!1}},{key:"render",value:function(){return r.a.createElement(v.q,{item:!0,sm:6,md:6,lg:6,className:"canvas-container"},r.a.createElement(v.t,{className:"play-button",onClick:this.toggleAudio,disableRipple:!0,disableTouchRipple:!0},this.state.play?r.a.createElement(X.a,{style:{fontSize:"180px"}}):r.a.createElement($.a,{style:{fontSize:"180px"}})),this.state.play?r.a.createElement(ee,{audioData:this.state.audioData}):r.a.createElement("canvas",{width:"300",height:"300",className:"audio-canvas"}))}}]),t}(n.Component),ae=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).toggleExample=function(){a.setState({showExample:!a.state.showExample})},a.handleClickOpen=function(){a.setState({open:!0})},a.handleClose=function(){a.setState({open:!1,showExample:!1})},a.state={open:!1,showExample:!1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(v.b,{onClick:this.handleClickOpen},"Rules"),r.a.createElement(v.j,{open:this.state.open,onClose:this.handleClose},r.a.createElement(v.m,null,"Game Rules"),r.a.createElement(v.l,null,r.a.createElement("ul",{className:"rule-list"},r.a.createElement("li",null,"You will be presented with one randomly selected 10-second sound clip at a time."),r.a.createElement("li",null,'Describe that clip with a word or phrase (we call them "tags", here are some\xa0',r.a.createElement(v.c,{onClick:this.toggleExample,style:{fontSize:"0.9em",textDecoration:"underline"}},"examples"),") and ",r.a.createElement("b",null,"press enter"),"."),this.state.showExample?r.a.createElement("div",{className:"example-tags-list"},r.a.createElement("ul",null,r.a.createElement("li",null,"Animals \u2013 bird, songbird, sparrow, white-crowned sparrow, gambel's white crowned sparrow"),r.a.createElement("li",null,"Human-generated sounds \u2013 airplane, helicopter, drilling, engine, rumbling"),r.a.createElement("li",null,"Weather \u2013 wind, rain, thunder, gale, drizzle, dripping, stream, river"),r.a.createElement("li",null,"Scenes \u2013 quiet night, dawn chorus"),r.a.createElement("li",null,"Time \u2013 summer, winter, june, august afternoon, night, dawn"),r.a.createElement("li",null,"Feelings \u2013 calm, busy, soothing, loud, cacophonous"))):"",r.a.createElement("li",null,"If you're the first person to describe that clip with that tag, you'll get ",r.a.createElement("b",null,"2 points")," when the next person tags that clip with that tag."),r.a.createElement("li",null,"If you're the second person to describe that clip with that tag, you'll get ",r.a.createElement("i",null,"1 point")," immediately."),r.a.createElement("li",null,"If more than two people have already tagged that clip with that tag, you ",r.a.createElement("span",{className:"pink"},"won't get any points"),", but you can try another tag."),r.a.createElement("li",null,'Tag each clip as many times as you want, follow one of the "next clip" links to listen to a new one.'))),r.a.createElement("p",{style:{margin:"0em 2em 2em"}},'You can come back to see the rules by clicking "rules" at the top-left corner.')))}}]),t}(n.Component);function ne(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function re(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ne(a,!0).forEach((function(t){Object(z.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ne(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var oe={currentTags:{},displayTag:{},loading:!0},ce=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=Object(O.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.user=b.auth().currentUser,a.db=b.firestore(),a.currentId=b.auth().currentUser.uid,a.userRef=a.db.collection("users").doc(a.currentId),a.firstUserId="",a.loadUrl();case 6:case"end":return e.stop()}}),e)}))),a.handleKeyPress=function(e){"Enter"===e.key&&document.getElementById("submitButton").click()},a.loadFiles=Object(O.a)(x.a.mark((function e(){var t,n,r,o,c,s,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new XMLHttpRequest,c=[],e.next=4,a.db.collection("audios");case 4:return s=e.sent,e.next=7,a.db.collection("Randomize");case 7:i=e.sent,n.onreadystatechange=Object(O.a)(x.a.mark((function e(){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200===n.status&&4===n.readyState)for(t=n.responseText,console.log(typeof t),r=JSON.parse(t),o=r.items,a=0;a<o.length;a++)s.doc(a+"").set({Title:o[a].name,Url:"https://firebasestorage.googleapis.com/v0/b/majorminer-dd13a.appspot.com/o/"+o[a].name+"?alt=media&token="+o[a].metadata.firebaseStorageDownloadTokens}),i.doc(a+"").set({count:0}),console.log(a);case 1:case"end":return e.stop()}}),e)}))),n.open("GET","/text/data.json",!0),n.send(),console.log(c.length);case 12:case"end":return e.stop()}}),e)}))),a.loadUrl=Object(O.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("currentUser: "+b.auth().currentUser.uid),a.existingTags={},e.next=4,a.randomizeId();case 4:return a.clipId=e.sent,console.log(a.clipId),e.next=8,a.db.collection("audios").doc(a.clipId);case 8:return a.audioRef=e.sent,e.prev=9,e.next=12,a.audioRef.get();case 12:t=e.sent,a.url=t.data().Url,console.log(a.clipId),console.log(a.url),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),console.log(e.t0);case 21:return e.next=23,a.setState({loading:!1});case 23:case"end":return e.stop()}}),e,null,[[9,18]])}))),a.loadExistingTag=function(e){try{e&&e.forEach((function(e){return a.existingTags[e.id]={count:e.data().count}}))}catch(t){console.log("loadExistingTagError: "+t)}return a.existingTags},a.compareTime=function(){var e=Object(O.a)(x.a.mark((function e(t){var a,n,r,o,c,s,i,l,u,m,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=[])[0]="January",a[1]="February",a[2]="March",a[3]="April",a[4]="May",a[5]="June",a[6]="July",a[7]="August",a[8]="September",a[9]="October",a[10]="November",a[11]="December",n=t.toMillis(),console.log("that time: ",n),r=new Date,o=r.getDay()+"",c=r.getDate()+"",s=a[r.getMonth()]+" ",i=r.getFullYear()+"",console.log("day",o),console.log("date ",c),console.log("month",s),console.log("year",i),l=s+c+", "+i,console.log(l),u=Date.parse(l),console.log("today: ",u),m=Date.now(),console.log("now: ",m),!((d=m-n)<=36e5)){e.next=36;break}return console.log("within an hour",d),e.abrupt("return",1);case 36:if(!(n<=u+864e5)){e.next=41;break}return console.log("it's today"),e.abrupt("return",2);case 41:if(!(n<=u+6048e5)){e.next=46;break}return console.log("this week"),e.abrupt("return",3);case 46:return console.log("long time ago"),e.abrupt("return",4);case 48:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.oneDayRange=function(){var e=[];e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December";var t=new Date,a=t.getDate()+"",n=e[t.getMonth()]+" "+a+", "+(t.getFullYear()+""),r=Date.parse(n);return console.log("today: ",r),r+864e5},a.randomizeId=Object(O.a)(x.a.mark((function e(){var t,n,r,o,c,s,i,l,u,m,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Set,r=Math.random(),e.next=4,a.db.collection("Randomize").where("userId","array-contains",a.currentId).get();case 4:for(o=e.sent,c=!0,s=!1,i=void 0,e.prev=8,l=o.docs[Symbol.iterator]();!(c=(u=l.next()).done);c=!0)m=u.value,n.add(m.id);e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),s=!0,i=e.t0;case 16:e.prev=16,e.prev=17,c||null==l.return||l.return();case 19:if(e.prev=19,!s){e.next=22;break}throw i;case 22:return e.finish(19);case 23:return e.finish(16);case 24:return d=a.findMin(.0066*o.size,.33),console.log("rand",r),console.log("pnew",d),r<d?(t=a.pick_pioneer(),console.log("rand < pnew")):(t=a.pick_settler(n),console.log("rand > pnew")),e.abrupt("return",t);case 29:case"end":return e.stop()}}),e,null,[[8,12,16,24],[17,,19,23]])}))),a.pick_pioneer=Object(O.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.db.collection("Randomize").where("count","==",0).get();case 2:if(0===(t=e.sent).size){e.next=6;break}return console.log("noSeenSnapshot[0]"),e.abrupt("return",t.docs[0].id+"");case 6:return console.log("Math.random"),e.abrupt("return",Math.floor(5*Math.random())+"");case 8:case"end":return e.stop()}}),e)}))),a.pick_settler=function(){var e=Object(O.a)(x.a.mark((function e(t){var n,r,o,c,s,i,l,u,m,d,h,p,g,f,y;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),r=n-36e5,e.next=4,a.db.collection("Randomize").where("millis","<",r).orderBy("millis").get();case 4:if(0!==(o=e.sent).size){e.next=10;break}return console.log("oneHourNoSeenSnapshot == 0"),e.abrupt("return",a.pick_pioneer());case 10:for(console.log("oneHourNoSeenSnapshot:  ",o),c=!0,s=!1,i=void 0,e.prev=14,l=o.docs[Symbol.iterator]();!(c=(u=l.next()).done);c=!0)m=u.value,console.log("oneHourNoSeenSnapshot",m.id);e.next=22;break;case 18:e.prev=18,e.t0=e.catch(14),s=!0,i=e.t0;case 22:e.prev=22,e.prev=23,c||null==l.return||l.return();case 25:if(e.prev=25,!s){e.next=28;break}throw i;case 28:return e.finish(25);case 29:return e.finish(22);case 30:d=!0,h=!1,p=void 0,e.prev=33,g=o.docs[Symbol.iterator]();case 35:if(d=(f=g.next()).done){e.next=43;break}if(y=f.value,t.has(y.id)){e.next=40;break}return console.log("!userHasSeen.has(clip.id)"),e.abrupt("return",y.id+"");case 40:d=!0,e.next=35;break;case 43:e.next=49;break;case 45:e.prev=45,e.t1=e.catch(33),h=!0,p=e.t1;case 49:e.prev=49,e.prev=50,d||null==g.return||g.return();case 52:if(e.prev=52,!h){e.next=55;break}throw p;case 55:return e.finish(52);case 56:return e.finish(49);case 57:return e.abrupt("return",a.pick_pioneer());case 58:case"end":return e.stop()}}),e,null,[[14,18,22,30],[23,,25,29],[33,45,49,57],[50,,52,56]])})));return function(t){return e.apply(this,arguments)}}(),a.findMin=function(e,t){return e>t?t:e},a.getNextClip=Object(O.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.setState({currentTags:{},loading:!0,displayTag:{}});case 2:a.loadUrl();case 3:case"end":return e.stop()}}),e)}))),a.handleSubmit=Object(O.a)(x.a.mark((function e(){var t,n,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("tags").value.toLowerCase().replace(/\s/g,"").split(","),n={},e.next=4,a.audioRef.collection("tags");case 4:return a.audioTagRef=e.sent,e.next=7,a.audioRef.collection("users");case 7:return a.audioUsersRef=e.sent,e.next=10,a.audioTagRef.get();case 10:return r=e.sent,e.next=13,a.loadExistingTag(r);case 13:a.existingTags=e.sent,console.log("existingTags"),console.log(a.existingTags),t.forEach((function(e){Object.keys(a.existingTags).includes(e)?n[e]={count:a.existingTags[e].count,score:0}:n[e]={count:0,score:0}})),console.log("displayTag"),console.log(a.state.displayTag),document.getElementById("tags").value="",a.loadTagsToDb(n).then((function(e){a.setState({currentTags:e});for(var t=function(){var t=r[n];a.setState((function(a){return{displayTag:re({},a.displayTag,Object(z.a)({},t,{score:e[t].score,count:e[t].count}))}}))},n=0,r=Object.keys(e);n<r.length;n++)t()}));case 21:case"end":return e.stop()}}),e)}))),a.getUserId=function(){var e=Object(O.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.db.collection("audios").doc(a.clipId).collection("users").where("tags","array-contains",t).get();case 2:return n=e.sent,console.log("firstUser:  ",n.docs[0].id),e.abrupt("return",n.docs[0].id);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.loadTagsToDb=function(){var e=Object(O.a)(x.a.mark((function e(t){var n,r,o,c,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=0,r=Object.keys(t);case 2:if(!(n<r.length)){e.next=24;break}return o=r[n],e.next=6,a.addUser(o);case 6:if(a.History(a.userRef,a.currentId,0),1!==t[o].count){e.next=18;break}return e.next=10,a.getUserId(o);case 10:return c=e.sent,e.next=13,a.db.collection("users").doc(c);case 13:s=e.sent,console.log("!!firstUserId: "+c),c!==a.currentId&&(a.History(s,c,2),t[o].score=1,a.History(a.userRef,a.currentId,1)),e.next=19;break;case 18:t[o].count,a.History(a.userRef,a.currentId,0);case 19:return e.next=21,a.audioUsersRef.doc(a.currentId).set({tags:y.a.firestore.FieldValue.arrayUnion(o)},{merge:!0});case 21:n++,e.next=2;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),console.log("can't upload tags into DB!!:  "+e.t0);case 29:return e.abrupt("return",t);case 30:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t){return e.apply(this,arguments)}}(),a.addUser=function(e){try{a.audioTagRef.doc(e).set({count:y.a.firestore.FieldValue.increment(1),userId:y.a.firestore.FieldValue.arrayUnion(a.currentId)},{merge:!0})}catch(t){console.log("can't add user: "+t)}},a.refreshTotalScore=function(e,t){e.update({score:y.a.firestore.FieldValue.increment(t)})},a.isFrist=function(e){a.audioTagRef.doc(e).set({count:1,userId:y.a.firestore.FieldValue.arrayUnion(a.currentId)})},a.History=function(){var e=Object(O.a)(x.a.mark((function e(t,n,r){var o,c,s,i,l,u;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.collection("clipHistory");case 3:(o=e.sent).doc(a.clipId).get().then((function(e){e.exists?a.updateHistory(o,r):a.createHistory(o,r),a.refreshTotalScore(t,r)})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("Can't create clipHistory!! "+e.t0);case 10:if(0===r){e.next=28;break}return c=a.oneDayRange(),e.prev=12,s=a.db.collection("scoreRecord").doc(n),e.next=16,a.db.collection("scoreRecord").doc(n).collection("score");case 16:return(i=e.sent).doc(c+"").get().then((function(e){e.exists?i.doc(c+"").update({score:y.a.firestore.FieldValue.increment(r)}):i.doc(c+"").set({score:r,millis:c,createdAt:y.a.firestore.FieldValue.serverTimestamp()})})),e.next=20,a.db.collection("users").doc(n).get();case 20:l=e.sent,u=l.data().username,s.set({updated:y.a.firestore.FieldValue.serverTimestamp(),millis:c,username:u}),e.next=28;break;case 25:e.prev=25,e.t1=e.catch(12),console.log("Can't add score scoreRecord!");case 28:case"end":return e.stop()}}),e,null,[[0,7],[12,25]])})));return function(t,a,n){return e.apply(this,arguments)}}(),a.updateHistory=function(e,t){try{e.doc(a.clipId).update({score:y.a.firestore.FieldValue.increment(t),lastUpdatedAt:y.a.firestore.FieldValue.serverTimestamp()})}catch(n){console.log("Can't update clipHistory: "+n)}},a.createHistory=function(e,t){try{e.doc(a.clipId).set({score:y.a.firestore.FieldValue.increment(t),createdAt:y.a.firestore.FieldValue.serverTimestamp(),lastUpdatedAt:y.a.firestore.FieldValue.serverTimestamp()})}catch(n){console.log("Can't create clipHistory: "+n)}},a.state=re({},oe),a.textInput=r.a.createRef(),a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e,t){this.textInput.current.focus()}},{key:"render",value:function(){var e=this.url,t=this.clipId,a=this.state.displayTag;return r.a.createElement(v.q,{container:!0,className:"game-container",direction:"column",alignItems:"center",spacing:16},r.a.createElement(v.q,{item:!0,container:!0,alignItems:"center"},r.a.createElement(v.q,{item:!0,sm:1,md:1,lg:1},r.a.createElement(ae,null)),r.a.createElement(v.q,{item:!0,sm:10,md:10,lg:10},r.a.createElement("h1",null,"Describe this clip")),r.a.createElement(v.q,{item:!0,sm:1,md:1,lg:1})),r.a.createElement(v.q,{item:!0,container:!0,alignItems:"center"},r.a.createElement(v.q,{item:!0,sm:3,md:3,lg:3},r.a.createElement(w.a,{to:"/main",style:{textDecoration:"none"}},r.a.createElement(v.t,{id:"gameSummary",style:{borderRadius:"0"}},r.a.createElement(V.a,null),"Summary"))),this.state.loading?r.a.createElement(v.q,{item:!0,sm:6,md:6,lg:6,className:"canvas-container"},r.a.createElement(v.h,{size:100,thickness:3.6})):r.a.createElement(te,{url:e,clipId:t}),r.a.createElement(v.q,{item:!0,sm:3,md:3,lg:3},r.a.createElement(v.t,{id:"nextClip",style:{borderRadius:"0"},onClick:this.getNextClip},"Next Clip",r.a.createElement(_.a,null)))),r.a.createElement(v.q,{item:!0,id:"listTag",sm:10,md:6,lg:8},Object.keys(a).map((function(e,t){return 0===a[e].count?r.a.createElement("span",{key:t,className:"gray"},e+",","\xa0"):1===a[e].score?r.a.createElement("i",{key:t,className:"1-point"},e+",","\xa0"):r.a.createElement("span",{key:t,className:"pink"},e+",","\xa0")}))),r.a.createElement(v.q,{item:!0,sm:10,md:6,lg:8},r.a.createElement(v.n,{margin:"normal",fullWidth:!0},r.a.createElement(v.w,null,"Input your tags..."),r.a.createElement(v.u,{id:"tags",type:"text",autoFocus:!0,inputRef:this.textInput,onKeyPress:this.handleKeyPress,endAdornment:r.a.createElement(v.v,{position:"end"},r.a.createElement(v.t,{id:"submitButton",onClick:this.handleSubmit},r.a.createElement(B.a,null)),r.a.createElement(v.K,{title:r.a.createElement("p",null,"You can input more than one tag ",r.a.createElement("br",null),"by using commas to separate."),placement:"right"},r.a.createElement(v.s,null,r.a.createElement(G.a,null))))}),r.a.createElement(v.p,null,"Tag colors: ",r.a.createElement("i",null,"1 point"),", ",r.a.createElement("span",{className:"gray"},"no points yet (but could be 2)"),", ",r.a.createElement("span",{className:"pink"},"0 points"),"."))))}}]),t}(n.Component),se=a(125),ie=a(207),le=a.n(ie),ue=a(206),me=a.n(ue),de=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).setupAudioContext=function(){try{a.audioContext=new(window.AudioContext||window.webkitAudioContext),a.gainNode=a.audioContext.createGain(),a.gainNode.gain.value=15,a.gainNode.connect(a.audioContext.destination)}catch(e){console.log(e)}a.audio=new Audio(a.props.url),a.audioSource=a.audioContext.createMediaElementSource(a.audio),a.audio.crossOrigin="anonymous",a.audioSource.connect(a.gainNode),a.audioContext.resume().then((function(){console.log("Playback resumed successfully")})),a.audio.onended=function(){a.setState({play:!1}),a.props.togglePlay(!1)}},a.toggleAudio=function(){if(!1===a.state.play)try{a.setupAudioContext()}catch(e){console.log(e)}a.state.play?a.audio.pause():a.audio.play(),a.setState({play:!a.state.play}),a.props.togglePlay(!a.state.play)},a.toggleSeeOtherTags=function(){a.setState({seeOthers:!a.state.seeOthers})},a.state={play:!1,seeOthers:!1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.setupAudioContext()}},{key:"componentWillUnmount",value:function(){this.gainNode.disconnect(),this.audioSource.disconnect()}},{key:"render",value:function(){return r.a.createElement(v.d,{className:"audio-card"},r.a.createElement(v.f,null,r.a.createElement("h5",null,this.props.clip),r.a.createElement("p",null,"Your tags: ",this.props.TAG||"loading"),this.state.seeOthers?r.a.createElement("p",null,"Other's tags: ",this.props.other," "):""),r.a.createElement(v.e,{style:{paddingTop:"0"}},r.a.createElement(v.t,{onClick:this.toggleAudio},this.state.play?r.a.createElement(X.a,null):r.a.createElement($.a,null)),r.a.createElement(v.t,{onClick:this.toggleSeeOtherTags},this.state.seeOthers?r.a.createElement(me.a,null):r.a.createElement(le.a,null))))}}]),t}(n.Component),he=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).togglePlay=function(e){a.setState({play:e})},a.state={clipHistory:{},scoredClipHistory:{},play:!1},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(O.a)(x.a.mark((function e(){var t,a,n,r,o,c,s,i,l,u,m,d,h,p,g,f,y,E,v,w,k,O,j,S,C,I,T,P,A,q,D,N,R,M,U,F,H,z,W,B,L,_,K,V,Y,G,J,Z,$,Q,X,ee;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.user=b.auth().currentUser,this.db=b.firestore(),this.audioRef=this.db.collection("audios"),this.userId=this.user.uid,this.userRef=this.db.collection("users").doc(this.userId),t=[],a=[],e.next=9,this.userRef.collection("clipHistory").orderBy("lastUpdatedAt").limit(10).get();case 9:n=e.sent,r={},o=!0,c=!1,s=void 0,e.prev=14,i=n.docs[Symbol.iterator]();case 16:if(o=(l=i.next()).done){e.next=60;break}return u=l.value,r[u.id]={score:u.data().score},m=this.audioRef.doc(u.id).get(),t=[],a=[],d=this.audioRef.doc(u.id).collection("users").doc(this.userId).get(),h=this.audioRef.doc(u.id).collection("tags").get(),e.next=26,Promise.all([m,d,h]);case 26:for(p=e.sent,g=Object(se.a)(p,3),f=g[0],y=g[1],E=g[2],r[u.id].title=f.data().Title,r[u.id].url=f.data().Url,r[u.id].id=u.id,t=y.data().tags,r[u.id].TAG=t.join(", "),v=!0,w=!1,k=void 0,e.prev=39,O=E.docs[Symbol.iterator]();!(v=(j=O.next()).done);v=!0)S=j.value,t.includes(S.id)||a.push(S.id);e.next=47;break;case 43:e.prev=43,e.t0=e.catch(39),w=!0,k=e.t0;case 47:e.prev=47,e.prev=48,v||null==O.return||O.return();case 50:if(e.prev=50,!w){e.next=53;break}throw k;case 53:return e.finish(50);case 54:return e.finish(47);case 55:r[u.id].other=a.join(", "),this.setState({clipHistory:r});case 57:o=!0,e.next=16;break;case 60:e.next=66;break;case 62:e.prev=62,e.t1=e.catch(14),c=!0,s=e.t1;case 66:e.prev=66,e.prev=67,o||null==i.return||i.return();case 69:if(e.prev=69,!c){e.next=72;break}throw s;case 72:return e.finish(69);case 73:return e.finish(66);case 74:return e.next=76,this.userRef.collection("clipHistory").where("score",">",0).orderBy("score").limit(10).get();case 76:C=e.sent,I={},T=!0,P=!1,A=void 0,e.prev=81,q=C.docs[Symbol.iterator]();case 83:if(T=(D=q.next()).done){e.next=145;break}return N=D.value,I[N.id]={score:N.data().score},R=this.audioRef.doc(N.id).get(),M=this.audioRef.doc(N.id).collection("tags").where("userId","array-contains",this.userId).get(),U=this.audioRef.doc(N.id).collection("tags").get(),e.next=91,Promise.all([R,M,U]);case 91:for(F=e.sent,H=Object(se.a)(F,3),z=H[0],W=H[1],B=H[2],I[N.id].title=z.data().Title,I[N.id].url=z.data().Url,I[N.id].id=N.id,t=[],a=[],L=!0,_=!1,K=void 0,e.prev=104,V=W.docs[Symbol.iterator]();!(L=(Y=V.next()).done);L=!0)G=Y.value,t.push(G.id);e.next=112;break;case 108:e.prev=108,e.t2=e.catch(104),_=!0,K=e.t2;case 112:e.prev=112,e.prev=113,L||null==V.return||V.return();case 115:if(e.prev=115,!_){e.next=118;break}throw K;case 118:return e.finish(115);case 119:return e.finish(112);case 120:for(I[N.id].TAG=t.join(", "),J=!0,Z=!1,$=void 0,e.prev=124,Q=B.docs[Symbol.iterator]();!(J=(X=Q.next()).done);J=!0)ee=X.value,t.includes(ee.id)||a.push(ee.id);e.next=132;break;case 128:e.prev=128,e.t3=e.catch(124),Z=!0,$=e.t3;case 132:e.prev=132,e.prev=133,J||null==Q.return||Q.return();case 135:if(e.prev=135,!Z){e.next=138;break}throw $;case 138:return e.finish(135);case 139:return e.finish(132);case 140:I[N.id].other=a.join(", "),this.setState({scoredClipHistory:I});case 142:T=!0,e.next=83;break;case 145:e.next=151;break;case 147:e.prev=147,e.t4=e.catch(81),P=!0,A=e.t4;case 151:e.prev=151,e.prev=152,T||null==q.return||q.return();case 154:if(e.prev=154,!P){e.next=157;break}throw A;case 157:return e.finish(154);case 158:return e.finish(151);case 159:case"end":return e.stop()}}),e,this,[[14,62,66,74],[39,43,47,55],[48,,50,54],[67,,69,73],[81,147,151,159],[104,108,112,120],[113,,115,119],[124,128,132,140],[133,,135,139],[152,,154,158]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.clipHistory,n=t.scoredClipHistory;return r.a.createElement(v.q,{container:!0,className:"summary-container",direction:"column",alignItems:"center"},r.a.createElement(v.q,{item:!0},r.a.createElement("h1",null,"Summary Page")),r.a.createElement(v.q,{item:!0},r.a.createElement(w.a,{to:"/main/clip"},"Play game!")),r.a.createElement("h2",null,"Your last 10 clips"),r.a.createElement(v.q,{item:!0,className:"card-list-container"},r.a.createElement(v.q,{container:!0,className:"card-list",spacing:8},Object.keys(a).map((function(t,n){return r.a.createElement(v.q,{item:!0,key:t},r.a.createElement(de,{url:a[t].url,clip:a[t].title,clipId:a[t].id,TAG:a[t].TAG,togglePlay:e.togglePlay,other:a[t].other}))})))),r.a.createElement("h2",null,"Your last scored clips"),r.a.createElement(v.q,{item:!0,className:"card-list-container"},r.a.createElement(v.q,{container:!0,className:"card-list",spacing:8},Object.keys(n).map((function(t,a){return r.a.createElement(v.q,{item:!0,key:a},r.a.createElement(de,{url:n[t].url,clip:n[t].title,TAG:n[t].TAG,clipId:n[t].id,other:n[t].other,togglePlay:e.togglePlay}))})))))}}]),t}(n.Component),pe=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).month=function(){var e=[];return e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December",e},a.handleChange=function(e,t){a.setState({value:t})},a.oneDayRange=function(){var e=a.month(),t=new Date,n=t.getDate()+"",r=e[t.getMonth()]+" "+n+", "+(t.getFullYear()+""),o=Date.parse(r);return console.log("today: ",o),o+864e5},a.firstOfWeekRange=function(){var e=a.month(),t=new Date,n=t.getDay(),r=t.getDate()+"",o=e[t.getMonth()]+" "+r+", "+(t.getFullYear()+""),c=Date.parse(o);return console.log("first day of the week",n),c-36e5*(n-1)*24},a.getTotal=Object(O.a)(x.a.mark((function e(){var t,n,r,o,c,s,i,l,u;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,a.db.collection("users").where("score",">",0).get();case 3:for(n=e.sent,r=!0,o=!1,c=void 0,e.prev=7,s=n.docs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0)l=i.value,u={username:l.data().username,score:l.data().score,userId:l.id},t.push(u);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),o=!0,c=e.t0;case 15:e.prev=15,e.prev=16,r||null==s.return||s.return();case 18:if(e.prev=18,!o){e.next=21;break}throw c;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return t.sort((function(e,t){return t.score-e.score})),t.splice(10,t.length),e.next=27,a.setState({totalLeader:t});case 27:console.log(a.state.totalLeader);case 28:case"end":return e.stop()}}),e,null,[[7,11,15,23],[16,,18,22]])}))),a.getToday=Object(O.a)(x.a.mark((function e(){var t,n,r,o,c,s,i,l,u,m,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=a.oneDayRange(),e.next=4,a.db.collection("scoreRecord").where("millis","==",n).get();case 4:r=e.sent,o=!0,c=!1,s=void 0,e.prev=8,i=r.docs[Symbol.iterator]();case 10:if(o=(l=i.next()).done){e.next=20;break}return u=l.value,e.next=14,a.db.collection("scoreRecord").doc(u.id).collection("score").where("millis","==",n).get();case 14:m=e.sent,d={username:u.data().username,score:m.docs[0].data().score,userId:u.id},t.push(d);case 17:o=!0,e.next=10;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(8),c=!0,s=e.t0;case 26:e.prev=26,e.prev=27,o||null==i.return||i.return();case 29:if(e.prev=29,!c){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return t.sort((function(e,t){return t.score-e.score})),t.splice(10,t.length),e.next=38,a.setState({todayLeader:t});case 38:console.log("today: ",new Date(n)),console.log("today!!!leader: ",t);case 40:case"end":return e.stop()}}),e,null,[[8,22,26,34],[27,,29,33]])}))),a.getWeek=Object(O.a)(x.a.mark((function e(){var t,n,r,o,c,s,i,l,u,m,d,h,p,g,f,y,b,E;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=a.firstOfWeekRange(),console.log("thisWeekRange:  ",n),console.log("Sunday",new Date(n)),e.next=6,a.db.collection("scoreRecord").where("millis",">=",n).get();case 6:r=e.sent,o=!0,c=!1,s=void 0,e.prev=10,i=r.docs[Symbol.iterator]();case 12:if(o=(l=i.next()).done){e.next=42;break}return u=l.value,m=0,e.next=17,a.db.collection("scoreRecord").doc(u.id).collection("score").where("millis",">=",n).get();case 17:for(d=e.sent,h=!0,p=!1,g=void 0,e.prev=21,f=d.docs[Symbol.iterator]();!(h=(y=f.next()).done);h=!0)b=y.value,m+=b.data().score;e.next=29;break;case 25:e.prev=25,e.t0=e.catch(21),p=!0,g=e.t0;case 29:e.prev=29,e.prev=30,h||null==f.return||f.return();case 32:if(e.prev=32,!p){e.next=35;break}throw g;case 35:return e.finish(32);case 36:return e.finish(29);case 37:E={username:u.data().username,score:m,userId:u.id},t.push(E);case 39:o=!0,e.next=12;break;case 42:e.next=48;break;case 44:e.prev=44,e.t1=e.catch(10),c=!0,s=e.t1;case 48:e.prev=48,e.prev=49,o||null==i.return||i.return();case 51:if(e.prev=51,!c){e.next=54;break}throw s;case 54:return e.finish(51);case 55:return e.finish(48);case 56:return t.sort((function(e,t){return t.score-e.score})),t.splice(10,t.length),e.next=60,a.setState({weekLeader:t});case 60:console.log("weekLeader: ",t);case 61:case"end":return e.stop()}}),e,null,[[10,44,48,56],[21,25,29,37],[30,,32,36],[49,,51,55]])}))),a.getTabContent=function(e,t,n){var o;switch(a.state.value){case 0:o=e;break;case 1:o=t;break;case 2:o=n;break;default:o=[]}return r.a.createElement(v.D,{className:"leaderboard"},r.a.createElement(v.G,null,r.a.createElement(v.H,null,r.a.createElement(v.F,{align:"center"},"User"),r.a.createElement(v.F,{align:"center"},"Score"))),r.a.createElement(v.E,null,o.map((function(e,t){return r.a.createElement(v.H,{key:e.userId},r.a.createElement(v.F,{align:"center"},e.username),r.a.createElement(v.F,{align:"center"},e.score))}))))},a.state={value:0,todayLeader:[],weekLeader:[],totalLeader:[]},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.user=b.auth().currentUser,this.db=b.firestore(),this.user&&(this.currentId=b.auth().currentUser.uid),this.getTotal(),this.getToday(),this.getWeek()}},{key:"render",value:function(){var e=this.state,t=e.todayLeader,a=e.weekLeader,n=e.totalLeader;return r.a.createElement("div",null,r.a.createElement("h1",null,"Leaders"),r.a.createElement("div",{className:"table-container"},r.a.createElement(v.a,{position:"static"},r.a.createElement(v.I,{value:this.state.value,onChange:this.handleChange,centered:!0},r.a.createElement(v.C,{label:"Today"}),r.a.createElement(v.C,{label:"This week"}),r.a.createElement(v.C,{label:"Total"}))),this.getTabContent(t,a,n)))}}]),t}(n.Component),ge=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("h1",null,"Search")}}]),t}(n.Component),fe=Object(E.createMuiTheme)({palette:{primary:{main:"#C6C6CE"},secondary:{main:"#A6A6B2"}},typography:{useNextVariants:!0}});function ye(e){var t=e.component,a=e.authenticated,n=Object(d.a)(e,["component","authenticated"]);return r.a.createElement(h.a,Object.assign({},n,{render:function(e){return!0===a?r.a.createElement(t,Object.assign({},e,n)):r.a.createElement(p.a,{to:"/"})}}))}var be=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).toggleAuth=function(e){a.setState({authenticated:e})},a.state={authenticated:!1,user:null,loading:!0},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.listener=b.auth().onAuthStateChanged((function(t){t?e.setState({authenticated:!0,user:t,loading:!1}):e.setState({authenticated:!1,user:null,loading:!1})}))}},{key:"componentWillUnmount",value:function(){this.listener()}},{key:"render",value:function(){var e=this;return this.state.loading?r.a.createElement(E.MuiThemeProvider,{theme:fe},r.a.createElement("div",{className:"loading-container"},r.a.createElement(v.h,{size:100,thickness:3.6}))):r.a.createElement(E.MuiThemeProvider,{theme:fe},r.a.createElement(g.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(H,{authenticated:this.state.authenticated,toggleAuth:this.toggleAuth}),r.a.createElement("main",null,r.a.createElement(h.a,{exact:!0,path:"/",render:function(t){return r.a.createElement(A,Object.assign({},t,{authenticated:e.state.authenticated}))}}),r.a.createElement(h.a,{path:"/info/faq",component:D}),r.a.createElement(h.a,{path:"/info/contact",component:N}),r.a.createElement(h.a,{path:"/info/privacy",component:I}),r.a.createElement(h.a,{path:"/info/leaders",component:pe}),r.a.createElement(h.a,{path:"/search",component:ge}),r.a.createElement(ye,{exact:!0,path:"/main",component:he,authenticated:this.state.authenticated}),r.a.createElement(ye,{path:"/main/clip",component:ce,authenticated:this.state.authenticated})),r.a.createElement(q,null))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(be,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[267,1,2]]]);
//# sourceMappingURL=main.e9e57e3a.chunk.js.map